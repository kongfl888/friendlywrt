From e5760c162439a749ac12b9aafb5b5991b78d4f16 Mon Sep 17 00:00:00 2001
From: Lawrence-Tang <tangzongsheng@gmail.com>
Date: Thu, 12 Dec 2019 13:07:31 +0800
Subject: [PATCH 05/55] Revert "fix wifi ap issue"

This reverts commit 888212059cc03ce07ecd4a710acda37091692f35.
---
 package/base-files/files/etc/rc.local           |  2 --
 package/base-files/files/usr/bin/fix_wifi_ap.sh | 43 -------------------------
 2 files changed, 45 deletions(-)
 delete mode 100755 package/base-files/files/usr/bin/fix_wifi_ap.sh

diff --git a/package/base-files/files/etc/rc.local b/package/base-files/files/etc/rc.local
index 283adfcbc4..a07d8a48de 100644
--- a/package/base-files/files/etc/rc.local
+++ b/package/base-files/files/etc/rc.local
@@ -11,6 +11,4 @@ fi
 /bin/mount -a
 
 #iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
-/bin/sh /usr/bin/fix_wifi_ap.sh > /dev/null&
-
 exit 0
diff --git a/package/base-files/files/usr/bin/fix_wifi_ap.sh b/package/base-files/files/usr/bin/fix_wifi_ap.sh
deleted file mode 100755
index b76374171c..0000000000
--- a/package/base-files/files/usr/bin/fix_wifi_ap.sh
+++ /dev/null
@@ -1,43 +0,0 @@
-#!/bin/sh
-
-#
-# Fix loss of AP mode fails 
-#
-
-TIMEOUT=30
-SLEEP=3
-try_times=0
-DEVICENAME=phy0
-
-logger -t fix_wifi_ap "enter fix_wifi_ap.sh"
-if [ $(uci get wireless.default_radio0.mode | grep -c "ap") -eq 1 ]; then
-    while [ $(iwinfo | grep -c "ESSID: unknown") -ge 1 ]; do
-        let try_times=$try_times+1
-        logger -t fix_wifi_ap "loop times: ${try_times}"
-        if [ -f /var/run/hostapd-phy0.conf ]; then
-            logger -t fix_wifi_ap "found hostapd-phy0.conf"
-    	# same as /etc/hotplug.d/ieee80211/20-hostapd
-    	if [ -f /var/run/hostapd-${DEVICENAME}.pid ]; then
-                kill $(cat /var/run/hostapd-${DEVICENAME}.pid)
-    	    rm -rf /var/run/hostapd-${DEVICENAME}.pid
-            fi
-            logger -t fix_wifi_ap "force kill hostapd"
-            killall hostapd
-            if [ -d /var/run/hostapd-${DEVICENAME} ]; then
-                rm -rf /var/run/hostapd-${DEVICENAME}
-            fi
-            logger -t fix_wifi_ap "re-run hostapd"
-            /usr/sbin/hostapd -s -n phy0 -P /var/run/hostapd-${DEVICENAME}.pid -B /var/run/hostapd-phy0.conf
-        fi
-
-        if [ $((try_times * SLEEP)) -ge $TIMEOUT ]; then
-            break
-        fi
-        sleep $SLEEP
-    done
-else
-    logger -t fix_wifi_ap "do nothing, wireless.default_radio0.mode is not ap"
-fi
-
-logger -t fix_wifi_ap "leave fix_wifi_ap.sh"
-
-- 
2.14.1.windows.1

