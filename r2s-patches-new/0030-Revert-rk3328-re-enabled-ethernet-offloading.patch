From d5dfd11a3e5d855510c70ddf48a5b756f8d35a5d Mon Sep 17 00:00:00 2001
From: Lawrence-Tang <tangzongsheng@gmail.com>
Date: Wed, 26 Feb 2020 13:46:49 +0800
Subject: [PATCH 30/55] Revert "rk3328: re-enabled ethernet offloading"

This reverts commit a18e60350ef732682b6ffcce9769d3c23e8794e3.
---
 .../iface/12-disable-rk3328-eth-offloading         | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)
 create mode 100644 target/linux/rockchip-rk3328/base-files/etc/hotplug.d/iface/12-disable-rk3328-eth-offloading

diff --git a/target/linux/rockchip-rk3328/base-files/etc/hotplug.d/iface/12-disable-rk3328-eth-offloading b/target/linux/rockchip-rk3328/base-files/etc/hotplug.d/iface/12-disable-rk3328-eth-offloading
new file mode 100644
index 0000000000..5eb25c653a
--- /dev/null
+++ b/target/linux/rockchip-rk3328/base-files/etc/hotplug.d/iface/12-disable-rk3328-eth-offloading
@@ -0,0 +1,22 @@
+#!/bin/sh
+
+. /lib/functions.sh
+. /lib/functions/network.sh
+
+[ -n "$INTERFACE" ] || exit 3
+[ "$INTERFACE" == "wan" ] || exit 4
+[ "$ACTION" == "ifup" ] || exit 1
+
+BOARD=$(cat /tmp/sysinfo/board_name | cut -d , -f2)
+logger -t disable-offloading "board = $BOARD"
+[ "$BOARD" == "nanopi-r2" -o "$BOARD" == "nanopi-r2s" ] || exit 2
+logger -t disable-offloading "rk3328 board detected"
+
+ETHTOOL=/usr/sbin/ethtool
+[ -f $ETHTOOL ] || exit 5
+
+[ -d /sys/devices/platform/ff540000.ethernet/net/eth0 ] || exit 6
+$ETHTOOL -K eth0 rx off tx off
+
+logger -t disable-offloading "disabed rk3328 ethernet tcp/udp offloading tx/rx"
+exit 0
-- 
2.14.1.windows.1

