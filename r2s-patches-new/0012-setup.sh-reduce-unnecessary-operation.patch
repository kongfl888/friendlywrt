From faf600a6f8004dacbef05e589c41a9eaa0d12e63 Mon Sep 17 00:00:00 2001
From: Lawrence-Tang <tangzongsheng@gmail.com>
Date: Sun, 23 Feb 2020 16:46:12 +0800
Subject: [PATCH 12/39] setup.sh: reduce unnecessary operation

---
 package/base-files/files/root/setup.sh | 22 ++++++++++++++--------
 1 file changed, 14 insertions(+), 8 deletions(-)

diff --git a/package/base-files/files/root/setup.sh b/package/base-files/files/root/setup.sh
index 64681eda81..8a8f787ffc 100644
--- a/package/base-files/files/root/setup.sh
+++ b/package/base-files/files/root/setup.sh
@@ -2,6 +2,8 @@
 
 # THIS SCIPRT ONLY RUN ONCE. Base on /etc/firstboot_${board}
 
+NEED_RESTART_SERVICE=0
+
 setup_ssid()
 {
     local r=$1
@@ -80,11 +82,11 @@ if [ -f /sys/class/sunxi_info/sys_info ]; then
 fi
 
 # update /etc/config/network
-WAN_IF=`uci get network.wan.ifname`
-if [ "x${WAN_IF}" = "xeth0" ]; then
-	uci set network.wan.dns=8.8.8.8
-	uci commit
-fi
+# WAN_IF=`uci get network.wan.ifname`
+# if [ "x${WAN_IF}" = "xeth0" ]; then
+# 	uci set network.wan.dns=8.8.8.8
+# 	uci commit
+# fi
 
 WIFI_NUM=`find /sys/class/net/ -name wlan* | wc -l`
 if [ ${WIFI_NUM} -gt 0 ]; then
@@ -105,10 +107,14 @@ EOF
     for i in `seq 0 ${WIFI_NUM}`; do
         setup_ssid radio${i}
     done
+    NEED_RESTART_SERVICE=1
 fi
 
-/etc/init.d/led restart
-/etc/init.d/network restart
-/etc/init.d/dnsmasq restart
+if [ ${NEED_RESTART_SERVICE} -eq 1 ]; then
+    /etc/init.d/led restart
+    /etc/init.d/network restart
+    /etc/init.d/dnsmasq restart
+    logger "setup.sh: restart network services"
+fi
 
 logger "done"
-- 
2.28.0.windows.1

